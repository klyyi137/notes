# 统一对接平台接口文档（B2B）

版本 | 日期 | 修订人 | 修订内容
---|---|---|---
v1.0|2019/08/06|杨剑|文档初稿
v1.1|2019/09/11|SnowPeak7|新增
v1.2|2019/09/17|杨剑|新增商品信息查询接口
---


## 接口说明
- Restful接口；==JSON==格式;请求头设置：Content-Type 为 application/json;charset=UTF-8
- http://unityplatform.ak1ak1.com为生产环境域名
- http://113.108.163.210:3777为测试环境IP地址
- 如测试IP地址后端口为其他如8849，则为阿康技术人员本地测试环境（端口可以根据联调进度自行切换）
- 加密字符串的字段排序为Ascii码正序排序连接

## 目录
1. [查询商品列表接口](#jumpGoodsList)
2. [B2B图片接口](#jumpB2Bpic)
3. [查询库存接口](#jumpStock)
4. [B2B下单接口](#jumpB2Border)
5. [订单物流查询接口](#jumpKD)
6. [查询商品信息接口](#jumpGoodsInfo)


> ### <span id="jumpGoodsList">查询商品列表接口</span>

- url(测试): http://113.108.163.210:3777/Platform/api/getGoodsList
- url(生产): http://unityplatform.ak1ak1.com/Platform/api/getGoodsList
- 查询我方给贵公司提供的药品信息表单

#### 请求方式：POST
#### 请求数据类型：JSON
##### 请求参数说明：

参数名|类型|必填|说明
-----|-----|-----|-----
companyCode|String|是|我方提供的公司编码，例如：aKang
appKey|String|是|我方提供的对接码，例如：AKJK
pageNo|String|是|页码(显示多少页，区间为1-1000) 
pageSize|String|是|每页显示多少条（区间为1-500） 
timestamp|String|是| 当前请求时间 格式类型&nbsp（yyyy-MM-dd HH:mm:ss,2018-07-26  21:02:07）
updateTime|String|否|时间格式类型（yyyy-MM-ddhh:mm:ss,2018-07-26 20:32:07）获取商品信息（如库存）有更新的数据，可自定义设置，获取某时间点之后有更新的数据(测试服务器不需要此参数)
sign|String|是|加密方式
createStarTime|String|否|商品创建开始时间，时间格式类型（yyyy-MM-ddhh:mm:ss,2018-07-26 20:32:07）
createEndTime|String|否|商品创建结束时间，时间格式类型（yyyy-MM-ddhh:mm:ss,2018-07-26 20:32:07）
#### 加密方法与注意事项：

```
sign值加密例子
  加密前参数字段名+参数值拼接列子
  appKey+对接码+companyCode+公司编码+pageNo+1+pageSize+10+timestamp+当前时间
  appKeyAKJKcompanyCodeaKangpageNo1pageSize10timestamp2018-07-26
  17:41:00
  在上面拼接前后加上秘钥
  YourAppSecretappKeyAKJKcompanyCodeaKangpageNo1pageSize10timestamp2018-07-26
  17:41:00YourAppSecret
  然后要sha512(上面的串)加密后在大写
```
#### 请求示例

```
{
	"companyCode": "test",
	"pageNo": "1",
	"sign": "D902F472D341A6DF56C25D0F7B655B69E08A50BF491330C135DED6A5DF4446A2A34CC855C44A1C1EB442B3786DF1557504BDDD6F70",
	"pageSize": "500",
	"appKey": "testkey",
	"timestamp": "2019-08-08 14:55:37"
}
```
#### 返回结果
###### 返回数据类型：JSON


参数名|类型|必填|说明
---|---|---|---
msg|String|否|返回提示
totalCount|Number|否|查询总条数
data| data [] | 否|商品数据
code|String|否|返回码：0为正常，1 参数异常、数据异常、其他异常
pageNo|String|否|页码
pageSize|String|否| 每页显示多少条

###### > data []

参数名|类型|必填|说明
---|---|---|---
goodsId|String|是|商品id
barCode|String|否|条码
goodsName|String|是|商品名
goodsType|String|是|商品规格
goodsUnit|String|是|商品单位
goodsCurrentName|String|否|通用名
purchasePrice|Double|否|进货价
price|Double|否|价格
availableqty|Integer|否|数量
factoryName|String|是|生产厂家
prodDate|String|否|生产日期
invalidDate|String|否|有效期
lotNo|String|否|批号
approveDocNo|String|是|批准文号
proPlace|String|否|生产地
ks|String|否|科室
sickness|String|否|主治
dosage|String|否|用法用量
otcFlag|Integer|否|是否处方0是处方，1非处方甲类 2非处方乙类
coldFlag|Integer|否|0是否冷链  1为冷链
medicineType|String|否|剂型
createTime|String|否|商品的创建时间
##### 数据示例
*以下数据仅当例子参考，以实际拉取到值为准
```
请求成功：

{
	"msg": "操作成功！",
	"code": "0",
	"data": [{
		"goodsId": "1032504",
		"barCode": "995135414",
		"goodsName": "【测试】这是一个注射液",
		"goodsCurrentName": "测试液",
		"goodsType": "1ml:0.1mg*10支/盒",
		"goodsUnit": "支",
		"purchasePrice": null,
		"price": 5.6,
		"availableqty": 23,
		"factoryName": "北京测试药业股份有限公司",
		"prodDate": "2018-04-11 00:00:00.0",
		"invalidDate": "2019-10-10 00:00:00.0",
		"lotNo": "20180401",
		"approveDocNo": "国药准字H20165154",
		"proPlace": null,
		"ks": "肿瘤科",
		"sickness": null,
		"dosage": null,
		"otcFlag": 0,
		"coldFlag": 1,
		"medicineType": null
	}],
	"pageNo": "1",
	"pageSize": "500",
	"totalCount": 1
}

请求失败：
{
    "msg":"相应错误信息！",
    "code":"1"
}

```
---

> ### <span id="jumpB2Bpic">B2B商品图片接口</span>

- url(测试): http://113.108.163.210:3777/Platform/api/getGoodsPicture
- url(生产): http://unityplatform.ak1ak1.com/Platform/api/getGoodsPicture
- 根据阿康商品ID获取商品图片

#### 请求方式：POST
#### 请求数据类型：JSON
##### 请求参数说明：

参数名|类型|必填|说明
-----|-----|-----|-----
companyCode|String|是|我方提供的公司编码，例如：aKang
appKey|String|是|我方提供的对接码，例如：AKJK
timestamp|String|是| 当前请求时间 格式类型&nbsp（yyyy-MM-dd HH:mm:ss,2018-07-26  21:02:07）
goodsId|String|是|商品id
sign|String|是|加密串
#### 加密方法与注意事项：

```
  sign值加密例子  
  加密前参数字段名+参数值拼接列子   
  appKey+对接码+companyCode+公司编码+goodsId+商品id+timestamp+当前时间
  appKeyAKJKcompanyCodeaKanggoodsId338timestamp2018-08-14 14:20:47  
  在上面拼接前后加上秘钥123456   
  123456appKeyAKJKcompanyCodeaKanggoodsId338timestamp2018-07-26
  17:41:00123456   
  然后对上面的字符串进行sha512加密，加密后转为大写
```
#### 请求示例：

```
这个太简单了自己想
```
#### 返回结构及结果：
参数名|类型|是否必须|说明
-----|-----|-----|-----
data| data [] | 否|商品图片集合（第一张可作为商品主图）
code| String | 否|  返回码：0为正常，1 参数异常、数据异常、其他异常
msg| String | 否|返回提示信息


```
响应成功
{
"msg":"操作成功！",
"code":"0",
"data":[
{"picId":15170,"goodsId":338,"pictureUrl":"http://www.xty999.com/upload/null/2017/10/27/b73d70dd-36b1-4aa1-91e1-929c748acd0e.jpg"},
{"picId":15171,"goodsId":338,"pictureUrl":"http://www.xty999.com/upload/null/2017/10/27/43d5aceb-8a0e-44b5-9fe4-628c9071ae86.jpg"},
{"picId":15172,"goodsId":338,"pictureUrl":"http://www.xty999.com/upload/null/2017/10/27/f947ddc1-1bcc-483b-bbf5-c79275631826.jpg"},
{"picId":15173,"goodsId":338,"pictureUrl":"http://www.xty999.com/upload/null/2017/10/27/e0dd4432-09a1-4c4a-ab17-2f7ad9759ddc.jpg"},
{"picId":15174,"goodsId":338,"pictureUrl":"http://www.xty999.com/upload/null/2017/10/27/31f1e786-bf97-49bc-b20d-7bd26108c9a0.jpg"}]
}
响应失败：
{
    "msg": "签名验证不通过，请检查参数传递！",
    "code": "1"
}
{
    "msg": "此商品暂无图片！",
    "code": "1"
}
{
    "msg": "签名验证不通过异常，请联系管理员！",
    "code": "1"
}
```
---

> ### B2B提交订单接口

- url(测试): http://113.108.163.210:3777/Platform/api/addOrder
- url(生产): http://unityplatform.ak1ak1.com/Platform/api/addOrder
- 输入订单数据，生成订单

#### 请求方式：POST
#### 请求数据类型：JSON
##### 请求参数说明：

参数名|类型|必填|说明
---|---|---|---
orderId|String|是|订单ID
companyCode|String|是|我方提供的公司编码，例如：aKang
appKey|String|是|我方提供的对接码，例如：AKJK
totalAmount|Double|是|总金额
deliveryer|String|是|收货人
phone|String|是|手机号码
address|String|是|详细地址
province|String|是|省 例如：广东省
city|String|是|市 例如：广州市
country|String|是|区 例如：白云区
payType|String|是|支付方式：1货到付款，4在线支付
timestamp|String|是|当前请求时间 格式类型（yyyy-MM-dd hh:mm:ss,2018-07-26 21:02:07）
customerId|String|是|客户id
sign|String|是|加密签名
goodsList|List<goodsInfo>|是|商品数据

##### goodsInfo属性说明：
参数名|类型|必填|说明
---|---|---|---
goodsId|String|是|商品id
goodsNum|String|是|商品数量
goodsPrice|String|是|价格

##### 参数示例
```
{
	"orderId": "44264080398402",
	"companyCode": "YourCompanyCode",
	"appKey": "YourAppKey",
	"totalAmount": 153.6,
	"deliveryer": "彭芳",
	"phone": "15264900132",
	"address": "时庄街道贵人街5号圣都堂药店",
	"province": "山东省",
	"city": "济宁市",
	"country": "曲阜市",
	"payType": 4,
	"timestamp": "2019-08-03 11:38:19",
	"customerId": 142616,
	"sign": "007C0B012D6804155CA0C59FD1C283B692212B3AF20A951982173A51CE0C088A81819FC51E5705E83E12E03C285441B9C3884F00FBD41D52F50DC9BAC2DBEC77",
	"goodsList": [{
		"goodsId": 2769,
		"goodsPrice": "31.80",
		"goodsNum": 2
	}, {
		"goodsId": 2768,
		"goodsPrice": "45.00",
		"goodsNum": 2
	}]
}
```

#### 加密注意事项：

```
加密前参数字段名+参数值拼接列子：
Address地址appKey对接码city市companyCode公司编码country区customerId客户iddeliveryer收货人goodsList商品集合orderId订单编号payType支付方式phone手机号码province省timestamp时间戳totalAmount总金额

address同泰路88号appKeyAKJKcity广州市companyCodeaKangcountry白云区customerId123deliveryer范伟伟goodsList[OrderDetailVerify [goodsId=1, goodsPrice=22, goodsNum=4], OrderDetailVerify [goodsId=2, goodsPrice=11.5, goodsNum=14]]orderId7596payType4phone13812341234province广东省timestamp2018-08-10 16:02:16totalAmount88.0

前后加上秘钥：
YourAppSecretaddress同泰路88号appKeyYourAppKeycity广州市companyCodeaKangcountry白云区customerId123deliveryer范伟伟goodsList[OrderDetailVerify [goodsId=1, goodsPrice=22, goodsNum=4], OrderDetailVerify [goodsId=2, goodsPrice=11.5, goodsNum=14]]orderId7596payType4phone13812341234province广东省timestamp2018-08-10 16:02:16totalAmount88.0YourAppSecret

最后进行sha512签名然后再全部转为大写。

注意：
1、OrderDetailVerify后须有一个空格，且后接的每组商品数据的属性均为“, ”（逗号+空格）拼接；
2、totalAmount若为整数时，后面必须带且仅带1位小数（.0），例如金额为5元/5.00元时，传值须为5.0；若非整数则正常传值即可；
3、加密时间有效期为3分钟，请检查发送请求时的主机时间确保与国家授时中心标准时间同步；
4、加密字符串中所有字段拼接顺序须按各字段名称的ASCII码顺序排列。
```

#### 返回数据类型：JSON
##### 返回数据说明

参数名|类型|必填|默认值|说明
---|---|---|---|---
code|string|否||返回码：0为正常，1 参数异常 1 订单已存在 1 其他异常
msg|String|否||提示信息：下单成功；订单已存在，请勿重复下单；签名验证不通过，请检查参数！


##### 数据示例
- 响应成功：
```
{
    "msg": "下单成功！",
    "code": "0"
}
```
- 响应失败：
```
{
    "msg": "签名验证不通过，请检查参数传递！",
    "code": "1"
}

{
    "msg": "下单失败，订单已存在！",
    "code": "1"
}

{
    "msg": "签名验证不通过异常，请联系管理员！",
    "code": "1"
}
```

> ### <span id="jumpStock">商品库存查询接口</span>
- url(测试): http://113.108.163.210:3777/Platform/api/getStore
- url(生产): http://unityplatform.ak1ak1.com/Platform/api/getStore
- 根据阿康商品ID查询商品库存（建议下单前使用本接口获取库存信息）

#### 请求方式：POST
#### 请求数据类型：JSON
##### 请求参数说明：

参数名|类型|必填|说明
-----|-----|-----|-----
companyCode|String|是|我方提供的公司编码，例如：AKang
appKey|String|是|我方提供的对接码，例如：AKJK
goodsIds|集合|是|传入商品id集合，上限1000个，如 goodsIds:[520, 646, 2522]
timestamp|String|是| 当前请求时间 格式类型&nbsp（yyyy-MM-dd HH:mm:ss,2018-07-26  21:02:07）
updateTime|String|否|时间格式类型（yyyy-MM-ddhh:mm:ss,2018-07-26 20:32:07）获取30分钟前库存有更新的数据，可自定义设置，获取5分钟，10分钟，20分钟等前库存有更新的数据(此参数不是必须的，测试时不传此参数，否则可能报错)
sign|String|是|加密方式

#### 参数示例：

```
{
"companyCode": "test",
"sign": "95CB15A945ADD30C93B62FAA0B11CD1B5A6BEA3314127370FCD2C3E46236DDD662D6950C01A3E4FD2580A8F8F4C79FD44F86806D74B37830",
"appKey": "test",
"goodsIds": [
"9930",
"993"
],
"timestamp": "2019-08-16 14:49:07"
}

```


#### 加密方法与注意事项：

```
sign值加密例子
加密前参数字段名+参数值拼接列子
appKey+对接码+companyCode+公司编码+goodsIds+[2522,520,646]   +timestamp+当前时间
appKeyAKJKcompanyCodeAKanggoodsIds[2522, 520, 646]timestamp2018-10-22 10:58:00
在上面拼接前后加上秘钥123456
123456appKeyAKJKcompanyCodeAKanggoodsIds[2522, 520, 646]timestamp2018-10-22 10:58:00123456
然后要sha512(上面的串)加密后在大写

1、请注意goodsIds集合中，商品ID拼接的方式均为“, ”（逗号+空格）拼接
```

#### 返回数据类型：JSON
##### 返回数据说明

参数名|类型|必填|说明
-----|-----|-----|-----
msg|String|是|响应信息
code|Integer|是|响应码
data|data[]|否|数据
goodsId|String|是|商品id
availableqty|Integer|否|数量


```
响应成功
{
    "msg": "操作成功！",
    "code": "0",
    "data": [
                {
                "goodsId": "993",
                "availableqty": 3
                },
                {
                "goodsId": "9930",
                "availableqty": null
                }
            ]
}

响应失败
{
    "msg": "签名验证不通过，请检查传递参数！",
    "code": "1"
}
{
    "msg": "签名验证不通过异常，请联系管理员！",
    "code": "1"
}

```
---

> ### <span id="jumpKD">订单发货信息查询接口</span>
- url(测试): http://113.108.163.210:3777/Platform/api/getLogisticsNumber
- url(生产): http://unityplatform.ak1ak1.com/Platform/api/getLogisticsNumber
- 根据订单号查询物流信息

#### 请求方式：POST
#### 请求数据类型：JSON
##### 请求参数说明：
参数名|类型|必填|说明
-----|-----|-----|-----
companyCode|String|是|我方提供的公司编码，例如：AKang
appKey|String|是|我方提供的对接码，例如：AKJK
orderIds|集合|是|传入订单id集合，上限20个，如orderIds[19012, 19013, 19014]
timestamp|String|是| 当前请求时间 格式类型&nbsp（yyyy-MM-dd HH:mm:ss,2018-07-26  21:02:07）
sign|String|是|加密方式

#### 请求参数示例：

```
{
"companyCode": "test",
"sign": "6547944EDB8212CB1E4EF692FC88069FDC753AFD0F6DD69JKD8D54GA3EEA5A6A5E26B0C6E6F55CFC4A53D8604D41D23B553F05CCAD4E05D87D3D",
"appKey": "test",
"orderIds": [
"337845818"
],
"timestamp": "2019-08-16 15:06:43"
}
```
#### 加密方法与注意事项：

```
sign值加密例子
  
加密前参数字段名+参数值拼接列子
  
appKey+对接码+companyCode+公司编码+orderIds+[19012, 19013]  +timestamp+当前时间
  
appKeyAKJKcompanyCodeAKangorderIds[19012,  19013]timestamp2019-02-15 14:47:00
  
在上面拼接前后加上秘钥123456
  
123456appKeyAKJKcompanyCodeAKangorderIds[19012,  19013]timestamp2019-02-15 14:47:00123456
  
然后要sha512(上面的串)加密后在大写

1、请注意orderIds集合中，订单ID拼接的方式均为“, ”（逗号+空格）拼接
```
#### 返回结果：
参数名|类型|必填|说明
-----|-----|-----|-----
msg|String|是|响应信息
code|Integer|是|响应码
data|data[]|否|数据

##### data[]：
参数名|类型|说明
-----|-----|-----|-----
orderId|String|订单ID
expressNumber|String|快递单号
expressCompany|String|物流公司


```
响应成功
{
	"msg": "查询成功",
	"code": "0",
	"data": [{
		"expressNumber": "6206325826696",
		"orderId": "5993845",
		"expressCompany": "顺丰物流"
	}, {
		"expressNumber": "463554785656",
		"orderId": "5990612",
		"expressCompany": "顺丰物流"
	}]
}

响应失败：
{
    "msg": "签名验证不通过，请检查传递参数！",
    "code": "1"
}
{
    "msg": "签名验证不通过异常，请联系管理员！",
    "code": "1"
}
```

> ### <span id="jumpGoodsInfo">商品信息查询接口</span>
- url(测试): http://113.108.163.210:3777/Platform/api/getGoodsInfo
- url(生产): http://unityplatform.ak1ak1.com/Platform/api/getGoodsInfo
- 根据阿康商品ID查询商品信息

#### 请求方式：POST
#### 请求数据类型：JSON
##### 请求参数说明：

参数名|类型|必填|说明
-----|-----|-----|-----
companyCode|String|是|我方提供的公司编码，例如：AKang
appKey|String|是|我方提供的对接码，例如：AKJK
goodsIds|集合|是|传入商品id集合，推荐300个以内，如 goodsIds:[520, 646, 2522]
timestamp|String|是| 当前请求时间 格式类型&nbsp（yyyy-MM-dd HH:mm:ss,2018-07-26  21:02:07）
sign|String|是|加密方式

#### 参数示例：

```
{
"companyCode": "test",
"sign": "95CB15A945ADD30C93B62FAA0B11CD1B5A6BEA3314127370FCD2C3E46236DDD662D6950C01A3E4FD2580A8F8F4C79FD44F86806D74B37830",
"appKey": "test",
"goodsIds": [
"9930",
"993"
],
"timestamp": "2019-08-16 14:49:07"
}

```

#### 加密方法与注意事项：

```
sign值加密例子
加密前参数字段名+参数值拼接列子
appKey+对接码+companyCode+公司编码+goodsIds+[2522,520,646]   +timestamp+当前时间
appKeyAKJKcompanyCodeAKanggoodsIds[2522, 520, 646]timestamp2018-10-22 10:58:00
在上面拼接前后加上秘钥123456
123456appKeyAKJKcompanyCodeAKanggoodsIds[2522, 520, 646]timestamp2018-10-22 10:58:00123456
然后要sha512(上面的串)加密后在大写

1、请注意goodsIds集合中，商品ID拼接的方式均为“, ”（逗号+空格）拼接
```

#### 返回结果
###### 返回数据类型：JSON


参数名|类型|必填|说明
---|---|---|---
msg|String|否|返回提示
code|String|否|返回码：0为正常，1 参数异常、数据异常、其他异常
data| data [] | 否|商品数据

###### > data []

参数名|类型|必填|说明
---|---|---|---
goodsId|String|是|商品id
barCode|String|否|条码
goodsName|String|是|商品名
goodsType|String|是|商品规格
goodsUnit|String|是|商品单位
goodsCurrentName|String|否|通用名
purchasePrice|Doubl|否|	进货价
price|Double|否|价格
availableqty|Integer|否|数量
factoryName|String|是|生产厂家
prodDate|String|否|生产日期
invalidDate|String|否|有效期
lotNo|String|否|批号
approveDocNo|String|是|批准文号
proPlace|String|否|生产地
ks|String|否|科室
BX|||
sickness|String|否|主治
dosage|String|否|用法用量
otcFlag|Integer|否|是否处方0是处方，1非处方甲类 2非处方乙类
coldFlag|Integer|否|0是否冷链  1为冷链
medicineType|String|否|剂型
updateTime|String|否|商品信息变更时间

##### 数据示例
*以下数据仅当例子参考，以实际拉取到值为准
```
请求成功：

{
	"msg": "操作成功！",
	"code": "0",
	"data": [{
		"goodsId": "1032504",
		"barCode": "995135414",
		"goodsName": "【测试】这是一个注射液",
		"goodsCurrentName": "测试液",
		"goodsType": "1ml:0.1mg*10支/盒",
		"goodsUnit": "支",
		"purchasePrice": null,
		"price": 5.6,
		"availableqty": 23,
		"factoryName": "北京测试药业股份有限公司",
		"prodDate": "2018-04-11 00:00:00.0",
		"invalidDate": "2019-10-10 00:00:00.0",
		"lotNo": "20180401",
		"approveDocNo": "国药准字H20165154",
		"proPlace": null,
		"ks": "肿瘤科",
		"sickness": null,
		"dosage": null,
		"otcFlag": 0,
		"coldFlag": 1,
		"medicineType": null,
		"updateTime": 2019-07-30 17:16:01.0
	}]
}

请求失败：
{
    "msg":"相应错误信息！",
    "code":"1"
}

```








